<?xml version="1.0" encoding="utf-8"?>
<s:BorderContainer xmlns:fx="http://ns.adobe.com/mxml/2009" 
				   xmlns:s="library://ns.adobe.com/flex/spark" 
				   xmlns:mx="library://ns.adobe.com/flex/mx" width="100%" height="100%"
				   creationComplete="creationCompleteHandler(event)">
	<fx:Declarations>
		<!-- Place non-visual elements (e.g., services, value objects) here -->
	</fx:Declarations>
	<fx:Style>
		@namespace s "library://ns.adobe.com/flex/spark";
		@namespace mx "library://ns.adobe.com/flex/mx";
		.VBoxBorder {
			borderSkin: ClassReference("mx.skins.halo.HaloBorder");
			borderStyle: solid;
			borderSides: "left right";
			borderWeight: 2px;
			borderColor: #000000;
		}
		.topBorder {
			borderSkin: ClassReference("mx.skins.halo.HaloBorder");
			borderStyle: solid;
			borderSides: "top";
			borderWeight: 2px;
			borderColor: #000000;
		}
	</fx:Style>
	<s:HGroup width="100%" height="100%">
		<!--<s:VGroup width="30%" height="100%">
			
		</s:VGroup>-->
		<s:VGroup width="100%" height="100%">
			<mx:Canvas id="parentCanvas" width="100%" height="100%" backgroundColor="0xCCCCCC" mouseOver="{zoomSlider.setFocus()}">
				<s:HGroup width="100%" height="100%" paddingTop="10" paddingLeft="10" paddingRight="10" paddingBottom="10">
					<mx:Canvas width="100%" height="100%" mouseOver="{Mouse.cursor = MouseCursor.HAND}" mouseOut="{Mouse.cursor = MouseCursor.ARROW}">
						<mx:Canvas id="childCanvas" x="200" width="850" height="1100" backgroundColor="0xFFFFFF" borderStyle="outset" borderAlpha="1">
							<s:Image x="14" y="17" source="assets/logo2.png"/>
							<s:VGroup y="89" width="100%" horizontalAlign="center" verticalAlign="middle">
								<s:Label color="0x000000" fontSize="12"
										 fontStyle="normal" fontWeight="bold" text="TIN: 411-846-093-000"
										 verticalAlign="middle"/>
								<s:Label color="0x000000" fontSize="18"
										 fontStyle="normal" fontWeight="bold" text="PURCHASE ORDER"
										 verticalAlign="middle" id="orderType"/>
							</s:VGroup>
							
							
							
							<s:Label x="584" y="41" color="0x000000" fontSize="14"
									 fontStyle="normal" fontWeight="bold" text="PO No. "
									 verticalAlign="middle"/>
							<s:Label id="poID" x="643" y="41" width="114" color="0x000000"
									 fontSize="14" fontStyle="normal" fontWeight="bold"
									 text="13-001A" textAlign="center" typographicCase="uppercase"
									 verticalAlign="middle"/>
							<s:BorderContainer x="16" y="139" width="{childCanvas.width-28}" height="190"
											   backgroundAlpha="0.0" borderVisible="false"
											   borderWeight="0" contentBackgroundAlpha="0.0"
											   dropShadowVisible="false">
								<s:layout>
									<s:VerticalLayout gap="-2"/>
								</s:layout>
								<s:BorderContainer width="{childCanvas.width-30}" height="95" borderColor="#000000"
												   borderWeight="2">
									<s:layout>
										<s:HorizontalLayout gap="0"/>
									</s:layout>
									<s:Label height="100%" color="#000000"
											 fontWeight="bold" paddingBottom="10" paddingLeft="15"
											 paddingRight="10" paddingTop="10" rotation="-90"
											 text="SUPPLIER" textAlign="center"
											 verticalAlign="middle"/>
									<mx:Canvas width="100%" height="95" styleName="VBoxBorder">
										<s:TextArea id="txtSupplier" x="0" y="0" width="100%" borderVisible="false"
												 height="100%" editable="false" paddingLeft="3" paddingTop="3"
												 prompt="&lt;Supplier&gt;" fontSize="13" verticalScrollPolicy="off">
											
										</s:TextArea>
									</mx:Canvas>
									<mx:Canvas width="375" height="95" styleName="VBoxBorder" verticalScrollPolicy="off" horizontalScrollPolicy="off"
											   color="#000000">
										
											<s:HGroup x="3" y="3" width="344" height="12" fontSize="13">
												<s:Label text="DATE:"/>
												<s:Label id="transDate" text="March 27, 2013"/>
											</s:HGroup>
											<s:Label id="poID2" x="42" y="18" width="114" fontSize="13"
													 text="{poID.text}"/>
											<s:BorderContainer x="-2" y="32" width="377" height="20"
															   borderColor="#000000" fontSize="13"
															   borderWeight="2">
												<s:Label x="3" y="2" text="TERM:"/>
												<s:TextInput x="41" y="-3" width="309" id="txtTerm"
															 borderAlpha="0" fontSize="11"
															 paddingLeft="10"
															 prompt="&lt;Terms&gt;"/>
												
											</s:BorderContainer>
											<s:VGroup x="0" y="54" width="100%" gap="0" paddingLeft="2" paddingTop="2" fontSize="13">
												<s:Label text="REFERENCE:"/>
												<s:TextInput width="348" borderAlpha="0"
															 paddingLeft="20" id="txtRef"
															 prompt="&lt; Reference &gt;"/>
											</s:VGroup>
									</mx:Canvas>
								</s:BorderContainer>
								<s:BorderContainer width="{childCanvas.width-30}" height="95" borderColor="#000000"
												   borderWeight="2">
									<s:layout>
										<s:HorizontalLayout gap="0"/>
									</s:layout>
									<s:Label height="100%" color="#000000"
											 fontSize="12" fontWeight="bold" paddingBottom="10"
											 paddingLeft="15" paddingRight="10" paddingTop="10"
											 rotation="-90" text="INVOICE TO" textAlign="center"
											 verticalAlign="middle"/>
									<mx:Canvas width="100%" height="90" backgroundAlpha="0.0"
											   borderAlpha="0.0" borderVisible="true"
											   dropShadowVisible="false" styleName="VBoxBorder">
										<s:TextArea id="txtInvoiceTo" x="0" y="0" width="100%" borderVisible="false"
													height="100%" editable="false" paddingLeft="3" fontSize="13"
													paddingTop="3" prompt="&lt;InvoiceTo&gt;" verticalScrollPolicy="off"/>
									</mx:Canvas>
									<s:Label height="100%" color="#000000"
											 fontWeight="bold" paddingBottom="10" paddingLeft="5"
											 paddingRight="5" paddingTop="10" rotation="-90"
											 text="DELIVER TO" textAlign="center"
											 verticalAlign="middle"/>
									<mx:Canvas width="100%" height="90" borderVisible="false"
											   styleName="VBoxBorder">
										<s:TextArea id="txtDeliverTo" x="0" y="0" width="100%" borderVisible="false"
												 height="100%" editable="false" paddingLeft="3" paddingTop="3"
												 prompt="&lt;DeliverTo&gt;" fontSize="13"/>
									</mx:Canvas>
								</s:BorderContainer>
							</s:BorderContainer>
							<s:VGroup x="16" y="340" width="{childCanvas.width-28}" height="100%" paddingBottom="20">
								<mx:Canvas width="100%">
									<s:HGroup y="540" id="notFol" width="100%" horizontalAlign="center">
										<s:Label text="-- NOTHING FOLLOWS --" fontSize="11" fontFamily="Arial" fontWeight="bold" trackingLeft="5"/>
									</s:HGroup>
									<s:DataGrid id="dg" width="100%" minHeight="360" fontSize="12"
												mouseChildren="false" mouseEnabled="false"
												sortableColumns="false" textAlign="center" borderVisible="false">
										<s:columns >
											<s:ArrayList>
												<s:GridColumn width="100" dataField="prodID" headerText="ID"/>
												<s:GridColumn dataField="qty" headerText="Qty" width="80"/>
												<s:GridColumn dataField="prodName" headerText="Description">
													<s:itemRenderer>
														<fx:Component>
															<s:DefaultGridItemRenderer textAlign="left"/>
														</fx:Component>
													</s:itemRenderer>
												</s:GridColumn>
												<s:GridColumn dataField="price" headerText="Price" width="180">
													<s:itemRenderer>
														<fx:Component>
															<s:DefaultGridItemRenderer textAlign="right"/>
														</fx:Component>
													</s:itemRenderer>
												</s:GridColumn>
												<s:GridColumn dataField="total" headerText="Total" width="220">
													<s:itemRenderer>
														<fx:Component>
															<s:DefaultGridItemRenderer textAlign="right" fontSize="14"/>
														</fx:Component>
													</s:itemRenderer>
												</s:GridColumn>
											</s:ArrayList>
										</s:columns>
									</s:DataGrid>
								</mx:Canvas>
								
								<s:Spacer height="100%"/>
								<s:VGroup width="100%" paddingLeft="30" paddingRight="5" gap="2">
									
									<s:Spacer height="100"/>
									<s:HGroup width="100%" horizontalAlign="right" fontSize="13">
										<s:Label text="Subtotal :" width="100" textAlign="right"/>
										<s:Spacer width="20%"/>
										<s:Label id="txtSub" text="0.00" textAlign="right"/>
									</s:HGroup>
									<s:HGroup width="100%" horizontalAlign="right" fontSize="13">
										<s:Label text="VAT:" width="100" textAlign="right"/>
										<s:Spacer width="20%"/>
										<s:Label id="txtVat" text="0.00" textAlign="right"/>
									</s:HGroup>
									<mx:HRule width="100%" height="2"/>
									<s:HGroup width="100%" fontFamily="Arial" fontWeight="bold" fontSize="14">
										<s:Label text="TOTAL"/>
										<s:Spacer width="100%"/>
										<s:Label id="txtTotal" text="0.00" textAlign="right"/>
									</s:HGroup>
									<mx:HRule width="100%"  height="2"/>
								</s:VGroup>
								<s:BorderContainer width="100%" height="100" borderColor="#000000" borderWeight="2">
									<s:layout>
										<s:HorizontalLayout gap="-2"/>
									</s:layout>
									<mx:Canvas  height="100">
										<s:Label x="10" y="5" fontFamily="Arial" fontWeight="bold" fontSize="14" text="Note to Supplier"/>
										<mx:Text x="10" y="20" htmlText="1. This order must be supplied in accordance with our instruction and spec, otherwise &lt;br/>     we reserve the right to reject your delivery, totally or partially of our sole discretion.&lt;br/>2. Indicate PO number in your invoice. delivery receipt or shipping documents.&lt;br/>3. Submit original PO together with your original invoice" />
									</mx:Canvas>
									<mx:Canvas width="100%" height="95" styleName="VBoxBorder" verticalScrollPolicy="off" horizontalScrollPolicy="off"
											   color="#000000">
										
										<s:VGroup paddingLeft="0" paddingTop="3" width="100%" height="12" gap="2">
											<s:Label text="ABOMAR EQUIPMENT SALES CORP." textAlign="center" width="100%" trackingLeft="2"/>
											<s:Spacer height="45"/>
											<s:Label text="MARIO C. OCHON" textAlign="center" width="100%" trackingLeft="1"/>
											<mx:Canvas width="100%" height="20" styleName="topBorder">
												<s:Label y="2" text="Authorized Signature" textAlign="center" width="100%" verticalAlign="middle"/>											
											</mx:Canvas>
										</s:VGroup>
										
									</mx:Canvas>
								</s:BorderContainer>
							</s:VGroup>
							
						</mx:Canvas>
					</mx:Canvas>
					
				</s:HGroup>
			</mx:Canvas>
			<s:HGroup width="100%" horizontalAlign="center" verticalAlign="middle" height="40">
				<s:Label text="Order Type: "/>
				<s:DropDownList id="cmbOrderType" change="OrderTypechangeHandler(event)" dataProvider="{arrOrderType}" labelField="name"
								selectedIndex="0" width="150"/>
				<s:Spacer width="10"/>
				<s:Label text="Zoom: "/>
				<s:HGroup width="200" horizontalAlign="center" horizontalCenter="0">
					<s:Label text="o"/>
					<s:HSlider id="zoomSlider" width="100%" maximum="250" minimum="25" value="100" dataTipFormatFunction="dataTipFormat" change="zoomHandler(event)"/>
					<s:Label text="O"/>
				</s:HGroup>
				<s:Spacer width="10"/>
				<s:Button label="Print" click="printPrevPO()"/>
				<s:Button label="Close" click="closeHandler(event)"/>
			</s:HGroup>
		</s:VGroup>
		
	</s:HGroup>
	<fx:Script>
		<![CDATA[
			import flashx.textLayout.formats.WhiteSpaceCollapse;
			
			import mx.collections.ArrayCollection;
			import mx.core.UIComponent;
			import mx.events.FlexEvent;
			import mx.formatters.DateFormatter;
			import mx.managers.PopUpManager;
			import mx.printing.FlexPrintJob;
			import mx.printing.FlexPrintJobScaleType;
			
			import spark.events.IndexChangeEvent;
			import spark.utils.TextFlowUtil;
			
			private var parentCanvasWidth:Number;
			private var parentCanvasHeight:Number;
			private var childCanvasWidth:Number;
			private var childCanvasHeight:Number;
			private var _orderTypeID:int = 0;
			private var _salesBox:Object;
			private var arrOrderType:ArrayCollection = new ArrayCollection(
				[{name:"Purchase Order",type:1},{name:"Sales Order",type:2},
				{name:"Sales Quote",type:3},{name:"Warehouse Transfer",type:4}])
			
			public function set boxType(value:Object):void{
				_salesBox = value;
			}
			public function set orderTypeID(value:int):void{
				_orderTypeID = value;
			}
			
			protected function creationCompleteHandler(event:FlexEvent):void
			{
				childCanvas.addEventListener(MouseEvent.MOUSE_DOWN, mouseDownHandler);
				childCanvas.addEventListener(MouseEvent.MOUSE_UP,mouseUpHandler);
				
				var rect:Rectangle = parentCanvas.getBounds(this);
				parentCanvasWidth = rect.width;
				parentCanvasHeight = rect.height;
				
				rect = childCanvas.getBounds(parentCanvas);
				childCanvasWidth = rect.width;
				childCanvasHeight = rect.height;
				
				childCanvas.x = parentCanvasWidth/2 - childCanvasWidth/2;
				//childCanvas.y = parentCanvasHeight/2 - childCanvasHeight/2;
				cmbOrderType.selectedIndex = _orderTypeID;
				OrderTypechangeHandler(null);
				setData();
			}
			
			private function zoomHandler(event:Event):void {
				childCanvas.scaleX = event.target.value/100;
				childCanvas.scaleY = event.target.value/100;
				
				/*var parentCanvasCenter:Point = new Point(parentCanvas.width/2,parentCanvas.height/2);
				
				var childCanvasCenter:Point = new Point(childCanvas.width/2, childCanvas.height/2);
				
				var center:Point = parentCanvasCenter.subtract(childCanvasCenter);
				trace(center.x + ", " + center.y);
				childCanvas.x = center.x;
				childCanvas.y = center.y;	*/
			}
			
			
			private function mouseDownHandler(event:MouseEvent):void {	
				childCanvas.startDrag();
			}
			
			private function mouseUpHandler(event:MouseEvent):void {
				childCanvas.stopDrag();	
				childCanvas.localToContent(new Point(event.localX,event.localY));
				//childCanvas.y = event.localY;
			}
			
			protected function closeHandler(event:MouseEvent):void
			{
				PopUpManager.removePopUp(this);
			}
			
			
			protected function dataTipFormat(value:Number):Object
			{
				return value+"%";
			}
			
			private function CurrentDateTimeString():String
			{               
				var CurrentDateTime:Date = new Date();
				var CurrentDF:DateFormatter = new DateFormatter();
				CurrentDF.formatString = "MMMM DD, YYYY"
				var DateTimeString:String = CurrentDF.format(CurrentDateTime);
				return DateTimeString;
			}
			
			private function setData():void
			{
				transDate.text = CurrentDateTimeString()
				
				dg.dataProvider = _salesBox.dg.dataProvider as ArrayCollection;
				notFol.y = (_salesBox.dg.dataProvider as ArrayCollection).length;
				var arrCus:Array = new Array();
				arrCus.push(_salesBox.cmbCustomer.textInput.text.split(" - ")[0]);
				arrCus.push(_salesBox.txtBname.text);
				arrCus.push(_salesBox.txtBAdd.text);
				if (_salesBox.txtBPhone.text != "")
				arrCus.push("Phone:"+_salesBox.txtBPhone.text);
				if (_salesBox.txtBMobile.text != "")
				arrCus.push("Mobile:"+_salesBox.txtBMobile.text);
				
				txtInvoiceTo.prompt="";
				txtInvoiceTo.selectable = false;
				txtInvoiceTo.textFlow =TextFlowUtil.importFromString(arrCus.join("\r"), WhiteSpaceCollapse.PRESERVE);
				
				txtSupplier.prompt="";
				txtSupplier.selectable = false;
				var contenttxtSupplier:String = "ABOMAR EQUIPMENT SALES CORP. \r4A Sapphire St. Gemsville Subd. Lahug" +
					"\rCebu City 6000, Philippines\rTel/Fax:63(32) 2311411";
				txtSupplier.textFlow =TextFlowUtil.importFromString(contenttxtSupplier, WhiteSpaceCollapse.PRESERVE);
				
				txtDeliverTo.prompt="";
				txtDeliverTo.selectable = false;
				txtDeliverTo.textFlow =TextFlowUtil.importFromString(arrCus.join("\r"), WhiteSpaceCollapse.PRESERVE);
				
				txtTotal.text = _salesBox.txtGT.text;
				txtSub.text = _salesBox.txtSubtot.text;
				txtVat.text = _salesBox.txtVat.text;
			}
			
			protected function printPrevPO():void
			{				
				var printJob:FlexPrintJob = new FlexPrintJob();
				if (printJob.start() != true) return;
				
				if (txtRef.text=="")
					txtRef.prompt = "";
				if (txtTerm.text=="")
					txtTerm.prompt = "";
				
				printJob.printAsBitmap = true;
				printJob.addObject(childCanvas, FlexPrintJobScaleType.SHOW_ALL); 
				printJob.send();
			}
			
			protected function OrderTypechangeHandler(event:IndexChangeEvent):void
			{
				orderType.text = cmbOrderType.selectedItem.name.toUpperCase();
			}
			
		]]>
	</fx:Script>
</s:BorderContainer>
